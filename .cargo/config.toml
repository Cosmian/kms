[alias]
# Check for formatting
format = "fmt --all -- --check"

# Build all features, all targets and all binaries
build-all = "build --workspace --all-targets --all-features --bins"
build-all-release = "build --release --workspace --all-targets --all-features --bins"

# Test FIPS and non-FIPS builds
test-fips = "test --lib --workspace"
test-non-fips = "test --lib --workspace --features non-fips"

# Run Clippy on all code paths
clippy-all = "clippy --workspace --all-targets --all-features -- -D warnings"

# Run coverage
coverage = "tarpaulin --release -v -f -t 1800 --out Xml --ignore-tests --exclude-files resources/* apps/*"

# Find unused dependencies
deps = "udeps --workspace --all-targets --all-features --backend depinfo"

# Publish dry-run helpers (allow dirty tree during local checks)
publish-dry = "publish --dry-run --workspace --allow-dirty"
publish-dry-crate = "publish --dry-run --allow-dirty"

###
# This options have been commented out because the Github runners responsible to build the KMS docker image have unpredictable CPU architectures, resulting in an error code 132 when running the generated container.
# However, those flags are specifically given by CI in other builds (macos, windows, linux, centos7) in cargo_build.yml via the RUSTFLAGS environment variable.
###
# [build]
# # Speeds up Ristretto 25519 multiplication x 2
# rustflags = [
#   "--cfg",
#   "curve25519_dalek_backend=\"simd\"",
#   "-C",
#   "target_cpu=native",
# ]

# can increase build time for system that support mold
# [target.x86_64-unknown-linux-gnu]
# linker = "clang"
# rustflags = ["-C", "link-arg=-fuse-ld=mold"]
